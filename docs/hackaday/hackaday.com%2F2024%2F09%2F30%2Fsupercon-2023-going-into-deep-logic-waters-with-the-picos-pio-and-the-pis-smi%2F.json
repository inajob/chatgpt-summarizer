{"pubDate": "2024-09-30T17:00:15", "original_title": "Supercon 2023 \u2013 Going into Deep Logic Waters With The Pico\u2019s PIO And The Pi\u2019s SMI", "link": "https://hackaday.com/2024/09/30/supercon-2023-going-into-deep-logic-waters-with-the-picos-pio-and-the-pis-smi/", "source": "https://hackaday.com/blog/feed/", "thumbnail": "https://hackaday.com/wp-content/uploads/2024/09/srefer.jpg", "original_content": "The Raspberry Pi has been around for over a decade now in various forms, and weve become plenty familiar with the Pi Pico in the last three years as well. Still, these devices have a great deal of potential if you know where to look. If you wade beyond the official datasheets, you might even find more than you expected.\nKumar is presently a software engineer with Google, having previously worked for Analog Devices earlier in his career. But more than that, Kumar has been doing a deep dive into maxing out the capabilities of the Raspberry Pi and the Pi Pico, and shared some great findings in an excellent talk at the 2023 Hackaday Supercon.\n\nUnder The Hood\n\nKumar begins by noting that a great many resources went into the creation of this talk. Worthy of note are Jeremy Benthams blog, which provided plenty of details on the Raspberry Pi and the workings of the Secondary Memory Interface (SMI). Beyond that, the Pi Pico documentation proved fruitful, as did several logic analyzer projects from out in the wild. Kumar collated this knowledge along with plenty of research, and put together a guide to some of the deeper functionality of the hardware with regards to the concept of a Pi Pico-based logic analyzer capable of running at 100 megasamples per second.\nKumars concept is for a hat that has an RP2040 connected to the Raspberry Pi via the SMI interface. It in turn is controlled via its debug pins.\nKumar notes the RP2040 chip at its heart has the useful Programmable I/O (PIO) subsystem, which allows for doing various I/O and data tasks quickly and efficiently. However, the chip is still limited to just 256 KB of RAM and a 1.5 MB/sec max data speed over USB. However, by combining the Pico with a Raspberry Pi 4, Kumar reckons its possible to create a 16 bit, 100 megasample/sec logic analyzer by using the right techniques. For looking at 3.3 V logic, the minimum hardware required would just be a Raspberry Pi and a single RP2040 microcontroller.\nHowever, a little extra functionality never goes astray. Kumar talks about building a prototype HAT add-on that adds a separate LDO regulator for the RP2040, 5 V tolerant logic buffers, and an I2C input expander to create a pretty useful little logic analyzer. Kumars original idea was to use the Pi Pico itself, but there was a problem. With only 26 usable GPIOs, its not possible to get 16-bits in and out of the device very easily. Hence, the idea to use the raw RP2040 for direct access to all the necessary pins. However, there was still a problem. The PIO subsystem can only control 30 pins.\nKumar was hacking on the prototype up to the last minute.\nTo get around this, Kumar noted that the less-flexible SIO subsystem can control all 36 GPIO pins. Kumar found a way to use the dual cores of the Pi Pico to sample the GPIOs via the SIO hardware every clock cycle while remaining in sync. Basically, the SIO hardware samples the inputs, puts the results in RAM, and then the DMA subsystem trucks this over to the PIO. The PIO then handles clocking the data out to the attached Raspberry Pi as required. Combining this technique with overclocking the Pi Pico would help Kumar nail the 100 megasamples/sec target; at the stock clockrate, it wouldnt be fast enough.\nThings only get more complicated from there. Kumar explains issues around bus contention within the Pico, as well as how to clock data into the Pi via the SMI interface. Its poorly documented, but Jeremy Benthams blog was a big help. The talk gets into the nitty gritty here, diving into the precise conditions needed to pipe lots of data out of the RP2040 and into the Pi itself. Meanwhile, the Pi itself gets control over the RP2040 via the SWD pins and GDB debugging with OpenOCD. Everything was then laced together with some code crafted with the aid of ChatGPT.\nThere were some kinks left to work out, with some aberrations that arent quite right in the data marked in red in Kumars testing.\u00a0\nBy the time Supercon rolled around, Kumar was still tangling with some details. The system was passing data from RP2040 to the Raspberry Pi at 41.666 MHz, though there were some aberrations. There was work left to be done on flow control and some other details to get the thing more functional. Kumar also speculated that the Pi 5 might open up new avenues to further improve the project.\nIts always interesting to see a project that pushes the limits of existing hardware. Kumar might not have finished his project just yet, but this talk gives us a great look at the challenges you face when you start trying to truck masses of data into and out of an RP2040, and in to a Raspberry Pi to boot!", "title": "Raspberry Pi\u3068Pi Pico\u306e\u6f5c\u5728\u80fd\u529b\u3092\u63a2\u308b", "body": "Raspberry Pi\u3068Pi Pico\u306b\u306f\u6f5c\u5728\u7684\u306a\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001Kumar\u6c0f\u306fPi\u3092\u6700\u5927\u9650\u306b\u6d3b\u7528\u3059\u308b\u305f\u3081\u306e\u65b9\u6cd5\u306b\u3064\u3044\u3066\u89e3\u8aac\u3057\u3066\u3044\u308b\u3002RP2040\u3092\u4f7f\u7528\u3057\u305f\u30ed\u30b8\u30c3\u30af\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3001RP2040\u3068Raspberry Pi\u3092\u7d44\u307f\u5408\u308f\u305b\u306616\u30d3\u30c3\u30c8100\u30e1\u30ac\u30b5\u30f3\u30d7\u30eb/\u79d2\u306e\u30ed\u30b8\u30c3\u30af\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u793a\u3057\u3066\u3044\u308b\u3002", "titles": ["Raspberry Pi\u3068Pi Pico\u306e\u6f5c\u5728\u80fd\u529b\u3092\u63a2\u308b", "Raspberry Pi\u3068Pi Pico\u306e\u6df1\u5c64\u6a5f\u80fd\u306b\u8feb\u308b", "RP2040\u3092\u6d3b\u7528\u3057\u305f16bit\u30ed\u30b8\u30c3\u30af\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u306e\u958b\u767a", "SMI\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5229\u7528\u3057\u305fHAT\u306e\u88fd\u4f5c", "RP2040\u3068Raspberry Pi\u306e\u30c7\u30fc\u30bf\u8ee2\u9001\u306b\u6311\u3080"]}