{"pubDate": "2024-06-18T14:00:25", "original_title": "Design Review: Switching Regulator Edition", "link": "https://hackaday.com/2024/06/18/design-review-switching-regulator-edition/", "source": "https://hackaday.com/blog/feed/", "thumbnail": "https://hackaday.com/wp-content/uploads/2024/04/PCBdesign.jpg", "original_content": "This article was prompted by a friend of mine asking for help on a board with an ESP32 heart. The board outputs 2.1 V instead of 3.3 V, and it doesnt seem like incorrectly calculated feedback resistors are to blame  lets take a look at the layout. Then, lets also take a look at a recently sent in design review entry, based on an IC that looks perfect for all your portable Raspberry Pi needs!\nWhat Could Have Gone Wrong?\nHeres the board in all its two-layer glory. This is the kind of board you can use to drive 5 V or 12 V Neopixel strips with a firmware like WLED  exactly the kind of gadget youll want to use for LED strip experiments! 3.3 V power is provided by a Texas Instruments TPS54308 IC, and its the one misfiring, so lets take a look.\n\n\n\n\n\nThe design has an ESP32 on the opposite side of the switching regulator. For review purposes, lets pull the regulator circuit out  disable all front layers (copper, silk, mask, courtyard and paste), hide vias, then box select the regulator circuit and move it out. Ive also added net labels to the circuit  heres a screenshot.\nThere are things done right here, for sure, and a few things that could be the culprit in improper regulation. If you want hints, you can see TPS54308 datasheet, page 22, for layout recommendations. Both SW and FB nodes are pretty long, and the FB trace goes right next to VOUT  before regulation.\nFurthermore, from the pinout and also the layout recommendations, it appears this regulator is designed in a way that all switching circuitry can be routed nicely. Yet, this design has the inductor go all the way to supposedly sensitive side. Thankfully, this is easy to fix.\nRefresher  FB and SW traces have to be as short as possible, inductor as close to SW as possible, and the VOUT to FB connection can be a separate tracks on the other layer. With that in mind, lets move the inductor to the other side of the regulator, move the FB resistors to the FB pin, and see how far we get.\nMy Take Versus TIs Recommendation\nThis is my take. FB resistors moved to one side, switching components to the other, VOUT track on another layer. Add capacitors and vias as necessary, and pull tracks under components to get extra ground connections if needed. Of course, ideally, SW would be a copper polygon, and so would be VOUT. Im also showing how EN could be pulled out, in case you needed that  in this particular schematic, EN can be safely left floating, but most regulators will want you to pull it either to VIN or to GND.\nSince this is a TI chip, it also has a diagram for the layout recommendation! Lets take a look how far off the mark we are, and it appears we arent that far. Curiously, it wants us to put SW onto another layer. Having switching current pass through extra inductance doesnt sit right with me, personally, but my guess is that they want to minimize switching current flowing under the regulator, as the recommendation suggests.\n\nAnother part thats curious to me, is a suggestion for a Kelvin connection for the FB nets GND pin. TI also publishes data for evaluation boards, and the TPS54308 has such a board indeed. Seeing on the page 13 of the evaluation board datasheet, Im not quite seeing a Kelvin connection, unless Kelvin is the name of the engineer involved in designing the board. I do see that GND is tapped with a via far away from the area where switching happens, so it might just be that.\nAt this point, Im curious whether my take is a dealbreaker, but since TIs recommendations are available, I might just end up implementing exactly that and sending the files back. So, we take this circuit, implant it back into the board, order a new revision, and keep our fingers crossed.\nA Pi-suited UPS, On A Stamp\nA week ago, [Lukilukeskywalker] has shared a board with us, asking for a design review. The board is a stamp that houses a LTC4040 chip, and the chip itself is a treat. It takes 5 V, outputs 5 V, and when connected, it generates 5 V from a battery. It supports both regular LiIon, can do up to 2.5 A, and appears to be a perfect option if you want to power a Raspberry Pi or any other 5 V-powered SBC on the go.\n\n\n\n\nThere are a few small nits to pick on this board. For instance, the connector for the battery is JST-SH, 3-pin, with one pin for BATT+. 2.5 A at 5 V means 12.5 W means up to 4 A at 3.5 V battery level, which might just melt a JST-SH connector or the gauge of wire you can attach to a JST-SH-sized metal contact. However, its switching regulator time, so lets take a look at that specifically.\nHeres another thing you might notice immediately  lack of ground path from the ICs ground connections, all the way under the switching path. In particular, the switching path is broken by a few traces, and it doesnt appear that these traces must be there! Page 22 in the LTC4040 datasheet, which lists the layout recommendations, also stresses upon this, elaborating that High frequency currents in the hot loop tend to flow along a mirror path on the ground plane which is directly beneath the incident path on the top plane of the board.\nWell, there are only two tracks that really interrupt the switching path above them, and both could be moved to the left. One of them is for a resistor that sets the charging current limit, and another goes to a castellated pad. Moving the latter is going to break the symmetry, but remember  its okay for a stamp to be asymmetric, that helps you ensure its mounted on your board correctly!\nSadly, while Linear Tech makes fancy tech, their evaluation board data isnt as available as TIs  theres a PDF with schematics, but no layout data I could find. However, comparing to the pictures, you can see that the general layout of the switching area is correct, our hacker correctly uses polygons, the feedback circuit is pretty nice  its just these two tracks that are a bit uncouth when it comes to the switching regulator part of it. As for reviewing the rest of the board, you can read this article!\nTowards A Powerful Future\nGot switching regulator designs that didnt quite work right when you put them to test, or that youre yet to order and feel cautious about? Show them to us down below in the comments, and lets take a look; your circuits deserve to operate at their best capacity possible.\nAnd, as usual, if you would like a design review for your board, submit a tip to us with [design review] in the title, linking to your board files. KiCad design files strongly preferred, both repository-stored files (GitHub/GitLab/etc) and shady Google Drive/Dropbox/etc .zip links are accepted.", "title": "ESP32\u30dc\u30fc\u30c9\u306e\u56de\u8def\u8a2d\u8a08\u306e\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0", "body": "\u8a18\u4e8b\u306e\u8981\u7d04\uff1a\u53cb\u9054\u304cESP32\u30dc\u30fc\u30c9\u306e\u554f\u984c\u3092\u76f8\u8ac7\u3057\u3066\u304d\u3066\u30013.3V\u4ee3\u308f\u308a\u306b2.1V\u3092\u51fa\u529b\u3057\u3066\u304a\u308a\u3001\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u62b5\u6297\u306e\u8a08\u7b97\u304c\u539f\u56e0\u3067\u306f\u306a\u3044\u3002\u56de\u8def\u8a2d\u8a08\u3092\u898b\u76f4\u3059\u3002\u307e\u305f\u3001Raspberry Pi\u5411\u3051IC\u3092\u4f7f\u7528\u3057\u305f\u30c7\u30b6\u30a4\u30f3\u30ec\u30d3\u30e5\u30fc\u30a8\u30f3\u30c8\u30ea\u3082\u691c\u8a0e\u3002", "titles": ["ESP32\u30dc\u30fc\u30c9\u306e\u56de\u8def\u8a2d\u8a08\u306e\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0", "Raspberry Pi\u5411\u3051\u30b9\u30a4\u30c3\u30c1\u30f3\u30b0\u30ec\u30ae\u30e5\u30ec\u30fc\u30bf\u306e\u8a2d\u8a08\u691c\u8a0e", "\u30ad\u30fc\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u306e\u6539\u5584\u65b9\u6cd5\u3092\u8003\u3048\u308b", "LTC4040\u30c1\u30c3\u30d7\u306b\u3088\u308bRaspberry Pi\u7528UPS\u306e\u8a2d\u8a08\u30ec\u30d3\u30e5\u30fc", "\u30b9\u30a4\u30c3\u30c1\u30f3\u30b0\u30ec\u30ae\u30e5\u30ec\u30fc\u30bf\u306e\u8a2d\u8a08\u3067\u306e\u30d1\u30bf\u30fc\u30f3\u306e\u91cd\u8981\u6027"]}