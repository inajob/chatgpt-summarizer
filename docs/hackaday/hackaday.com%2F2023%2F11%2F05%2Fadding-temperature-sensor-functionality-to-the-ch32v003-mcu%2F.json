{"pubDate": "2023-11-06T06:00:30", "original_title": "Adding Temperature Sensor Functionality To The CH32V003 MCU", "link": "https://hackaday.com/2023/11/05/adding-temperature-sensor-functionality-to-the-ch32v003-mcu/", "source": "https://hackaday.com/blog/feed/", "thumbnail": "https://hackaday.com/wp-content/uploads/2023/02/ch32v003-featured.jpg", "original_content": "Plot of the temperature measurement using the improvised CH32V003 -based temperature sensor. (Credit: eeucalyptus)\nAs cheap as the WCH CH32V003 MCU is, its approximately $0.10 price tag looks far less attractive when you need to start adding on external ICs for missing basic features, such as temperature measurement. This is a feature thats commonly found on even basic STM32 MCUs. Fear not though, as [eeucalyptus] shows, you can improvise a working solution by finding alternative sources that can act as a thermometer.\nThe CH32V003 is a low-end, 32-bit RISC-V-based MCU by the China-based Nanjing Qinheng Microelectronics, commonly known abbreviated as WCH, and featured on Hackaday previously. Although it features a single-core, 48 MHz CPU, its selection of peripherals is fairly basic:\nInternal diagram of the CH32V003 MCU. (Credit: WCH)\nSo how do you create an internal temperature sensor using just this? [eeucalyptus] figured that all thats needed is to measure the drift between two internal clocks  such as the LSI and HSI  as temperatures change and use this to calibrate a temperature graph. Unfortunately, the LSI isnt readily accessible, even through the Timer peripheral. This left the AWU (automatic wake-up unit) which also uses the LSI as a clock source. By letting it go to sleep and wake up after N LSI cycles, the AWU enabled indirect access to the LSI.\nAfter calibrating against room temperature (~22 \u00b0C) and ice water (0 \u00b0C), a temperature plot was obtained, which could conceivably be somewhat accurate. As [eeucalyptus] warns, this is a kind of calibration that likely differs per MCU, and no attempt to quantify the absolute accuracy of this method has been made yet. Even so, as a crude temperature measurement, it might just be good enough."}