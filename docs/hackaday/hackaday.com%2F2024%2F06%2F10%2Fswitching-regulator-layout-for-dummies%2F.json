{"pubDate": "2024-06-10T18:00:47", "original_title": "Switching Regulator Layout For Dummies", "link": "https://hackaday.com/2024/06/10/switching-regulator-layout-for-dummies/", "source": "https://hackaday.com/blog/feed/", "thumbnail": "https://hackaday.com/wp-content/uploads/2016/09/resistor.jpg", "original_content": "Last time, we went over switching regulator basics  why theyre wonderful, how do you find a switching regulator chip for your purpose, and how to easily pick an inductor for one. Your datasheet should also tell you about layout requirements. However, it might not, or you might want to deviate from them  lets go more in-depth on what those requirements are about.\nAppreciate The Feedback\nThe two resistors on the right decide what your output voltage will be, and their output is noise-sensitive\nTheres a few different switching regulator topologies. Depending on your regulators topology and how many components your chip contains, you might need some external components  maybe a Schottky diode, maybe a FET, or maybe even a FET pair. Its often that the FET is built-in, and same goes for diodes, but with higher-current regulator (2 A to 3 A and above), its not uncommon to require an external one. For sizing up those, youll want to refer to the datasheet or existing boards.\nAnother thing is input and output capacitors  dont skimp on those, because some regulators are seriously sensitive to the amount of capacitance theyre operating with. Furthermore, if you fail to consider things like capacitance dropping with voltage, you might make your regulator very unhappy  not that a linear regulator would be happy either, to be clear. Weve covered an explainer on this recently  do check it out!\nOne thing you will likely need, is a feedback resistor divider  unless your switching regulator is pre-set for a certain voltage or is digitally controlled, you need to somehow point it to the right voltage, in an analog way. Quite a few switching regulators are set for a certain voltage output, but most of them arent, and they will want you to add a resistor divider to know what to output. Theres usually a formula for resistor divider calculation, so, pick a common resistor value, put it in as one of the resistors into the formula, get the other resistor value out of that formula, and see whats the closest value you can actually buy. Dont go below about 10 k\u03a9 so that you dont have unnecessary idle power consumption, but also dont go too far above 100 k\u03a9 to ensure good stability of the circuit.\n\n\n\n\nSome datasheets might even have a table of pre-calculated values for you to use. In that table, they might call for a very specific resistor value, but you usually can tweak that for the cases where all of your components have enough leeway. Would you care if your output was 5.1 V as opposed to 5.0 V, or 3.5 V instead of 3.3 V? Usually, you wouldnt, and it might even be a little better if you increase the voltage a tad, so feel free to substitute that 157 k\u03a9 resistor for a 160 k\u03a9 one  just run the datasheet formula calculations to make sure you know what you will actually get.\nRespect The Layout\nIts not always that you have a layout example picture in the datasheet. For instance, it could be that you simply get a list of requirements for the layout, or even no requirements at all  sometimes youll just be reverse-engineering a board. Even if your datasheet is pretty good, sometimes, you will feel like deviating from the datasheet-provided example pictures. Here are some guidelines to know how to layout things safely.\nFor a start, when it comes to placement of the feedback resistors, youll want to put them both as close as possible to the FB pin  the midpoint connection between them (the FB-connected track) is the sensitive part, since its high-impedance. So, the FB connection ought to be very short, and, of course, the GND connection has to be good  having a via to the GND polygon at the FB-GND resistor is a good idea. On the other hand, its okay to pull the VOUT connection for the feedback divider on the opposite layer through vias, because that is a low-impedance connection and its less sensitive to noise. If feasible, connect the VOUT connection after the capacitors, too, so that it isnt measuring the point between the inductor and the capacitors, where current flows back and forth.\nIt pays to ensure that theres uninterrupted ground on the layer directly under your regulator, as clean as possible, save for maybe that VOUT track, but even that can be worth routing out of the way. Switching happens at high frequencies, anywhere from 100 kHz to 2 MHz, your regulator datasheet will say which,, and its a noisy process. Anything less than a full and accessible ground polygon under the switching areas can, in the worst case, turn your regulator into a full-on noise problem in your circuit.\n\n\n\n\n\n\n\n\nIf your regulator has an analog ground pad, respect that, and see what the datasheet says  the usual rule is to keep it away from the area where switching happens. Oh, and, its often that you need a ground fill directly under the regulator, on the same layer, too  for any switching that happens, whether its an internal FET and/or diode, or a driver for external FET gates. You can still try and protoboard a switching regulator circuit, but youll want to follow the next layout rule at the very least.\nIts important to put your inductor, diodes and all other components like capacitors as close to the switching regulator chip as you can. With current flowing through them at high frequencies, the connections between them can all become antennas, and the tighter you bundle all the components together, the smaller that antenna is  inducing less noise onto your circuit, which might interfere with WiFi or other wireless operation, analog measurements, or create weird faults in digital logic. Again, this is for you to mind in case theres no layout recommendation  most often, there is one somewhere in the datasheet, so look out for it! As for traces, you want to provide a connection thats as straightforward as possible. On connections where actual switching happens (the SW/LX connection from the chip to the inductor), use planes instead of tracks wherever you can.\nIn general, switching regulators are a bit of a noise source, so keep them away from analog parts; specifically, the SW/LX inductor-connected side. Thats not to say you cant use switching regulators for anything where you do analog  a ton of modern microcontroller boards and circuits are using small switching regulators, including the Pi Pico. There will still be a bit of noise on the output compared to linear regulators, so if you want a low-noise rail in some part of your project, say, analog supply voltage for sensitive measurements, you can usually add a low-power linear regulator, or use a Pi filter, or combine both. Also, if you need to get plenty of low-noise 3.3V from a high voltage like 20V, you can also do conversion from 20V to 5V with a switching regulator, and then get 3.3V out of 5V with a linear regulator.\nHaving assembled your board, do you notice your regulator making audible noise? Its usually not the inductor itself thats to blame, since switching regulator frequencies are kept pretty high. More often, it appears that either the regulators duty cycle, or the capacitors are at fault, specifically, MLCCs, and the way they interact with your output load. Its not an uncommon problem, though  heres a page from Murata that tries to sell fancier quiet capacitors to you, a fun appnote from TI, and a PDF from Monolithic Power that suggests you treat your PCB as a musical instrument.\nMake The World Go Round\nSwitching regulators are very much a part of our arsenal and have been for a long time, as theyre fundamentally friendly for many cases where linear regulators fail us. Raspberry Pi has famously gone from a linear regulator to a switching regulator, because the 1A-only 1117 regulator they used, turned out to be a bottleneck, and weve seen quite a few Pi mods from before-2014 where people would replace the old linear regulator with a small switching regulator module for power savings and reduced heat. Another spot for switching regulators is battery-powered devices, where a linear regulator is often not a good pick because the wasted power decreases time on a single charge significantly.\nIt also pays to learn a bit how switching regulators work in principle, and, you can have some fun with the concept! Whether thats making a switching regulator out of an opamp, using an ATTiny to do switching regulator duty, or repurposing the ubiquitous $1 switching regulator modules into negative rail power supplies, knowing the inner workings of a switching regulator makes your toolkit all that more rich. All in all, while a switching regulator might need a few more components, the extra effort is one hundred percent worth it, and if you have never added a switching regulator to your board before, your next design might be a good place to start!\nNext time, lets get down to business  pick a few switching regulators for common purposes, then pick components and do layout for a good few regulators at once, all done in an open-source design. After all, a picture speaks a thousand words, and Ill make sure there are plenty of those."}