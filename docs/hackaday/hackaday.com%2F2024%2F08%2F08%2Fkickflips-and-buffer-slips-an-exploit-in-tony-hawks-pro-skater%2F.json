{"pubDate": "2024-08-09T02:00:55", "original_title": "Kickflips and Buffer Slips: An Exploit in Tony Hawk\u2019s Pro Skater", "link": "https://hackaday.com/2024/08/08/kickflips-and-buffer-slips-an-exploit-in-tony-hawks-pro-skater/", "source": "https://hackaday.com/blog/feed/", "thumbnail": "https://hackaday.com/wp-content/uploads/2024/08/Tony-Hawks-Pro-Strcpy-3-10-screenshot.png", "original_content": "[Ryan Miceli] wanted to build some reverse engineering skills by finding a new exploit for an original Xbox. Where he ended up was an exploit that worked across the network, across several games, and several different consoles. But it all started with an unbounded strcpy in Tony Hawk Pro Skater (THPS).\nXbox, PlayStation 2, and Gamecube (often referred to as the sixth generation) are wonderful hacking targets as they dont possess many of the security enhancements of the seventh generation, like hypervisors, privilege levels, and hardware executability protections. The console launches the game, and control is fully within the game, so once you get your code executing, youre done. The exploit started with a feature in many Tony Hawk games, the custom map editor. In the editor, you can create gaps between jumps with a name so that when a player completes the gap, it can flash you jumped x in big letters. However, on Xbox, the gap name is copied with an unbounded strcpy to the stack, meaning you can overwrite the return pointer. Additionally, there are no stack cookies for THPS, which meant nothing stopped [Ryan] from smashing his way through. He includes a small memcpy stub in the header of the level, which the gap name jumps to, which then copies and executes his full payload.\nThe other games in the series, like Tony Hawks Pro Skater 3 (THPS3), had the bug, but the gap name was copied to the heap, not the stack. However, he could overflow into a vtable of the next object that would call his code when the object was freed. However, the level save data wasnt an executable region of memory, which meant he needed\u00a0ROP (return-oriented programming). Just a few gadgets later,\u00a0and [Ryan] had another exploit working.\nTony Hawks Underground 1 and 2 had stack cookies turned on. This meant a random value was placed on the stack before a function, then popped off and checked. This meant the program could check if its stack had been smashed. Unfortunately for [Ryan], this proved to be a major roadblock. However, the PC and PS2 versions of these games do not have stack cookies, which means they can be exploited in the same manner.\nThe beauty of the exploit is that the game allows you to invite a friend to play a custom level. This means once the level is transferred over the network, their console is hacked as well. However, the full payload wasnt sent to the client console, which meant the exploit had to send the payload to the other console using the games existing net code. The exploit sets up an asynchronous file transfer then hands control back to the game. Of course, there was a memory leak in the netcode, because the game had never sent large amounts of data over the network before. So, part of the exploit was a hot patch for a memory leak.\nAs a last hurrah, [Ryan] ported the hack to Gamecube, PS2, and PC. The\u00a0code is on GitHub, and the video is after the break. We love the attention the Xbox has been getting, and if youre curious about a hardware hack, this 256MB ROM mod goes deep into the internals.\n\n"}