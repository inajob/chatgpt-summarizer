{"pubDate": "2024-08-13T17:00:14", "original_title": "Portable Router Build: Picking Your CPU", "link": "https://hackaday.com/2024/08/13/portable-router-build-picking-your-cpu/", "source": "https://hackaday.com/blog/feed/", "thumbnail": "https://hackaday.com/wp-content/uploads/2024/08/hadimg_router_cpu_feat.jpg", "original_content": "I want to introduce you to a project of mine  a portable router build, and with its help, show you how you can build a purpose-built device. You might have seen portable routers for sale, but if youve been in the hacking spheres long enough, you might notice there are coverage gaps, so to speak. The Pi-hole project is a household staple that keeps being product-ized by shady Kickstarter campaigns, a mobile hotspot button is a staple in every self-respecting mobile and desktop OS, and a reset device for the ISP router is a whole genre of a hacker project. Sort the projects by All Time popularity on Hackaday.io, and near the very top, you will see an OpenVPN Tor router project  its there for a reason, and it got into 2014 Hackaday Prize semifinals for a reason, too.\nI own a bunch of devices benefitting from both an Internet connection and also point-to-point connections between them. My internet connection comes sometimes from an LTE uplink, sometimes from an Ethernet cable, and sometimes from an open WiFi network with a portal you need to click through before you can even ping anything. If I want to link my pocket devices into my home network for backups and home automation, I can put a VPN client on my laptop, but a VPN client on my phone kills its battery, and the reasonable way would be to VPN the Internet uplink  somehow, that is a feature Im not supposed to have, and lets not even talk about DNSSEC! Whenever I tried to use one of those portable LTE+WiFi[+Ethernet] routers and actively use it for a month or two, Id encounter serious hardware or firmware bugs  which makes sense, they are a niche product that wont get as much testing as phones.\n\nIve come to hate these little boxes with a passion. By [www.digitalpush.net], CC BY 4.0Solving these problems and implementing my desired features is quite motivational for me  its not just that I need my devices to work for me, its also that every time I tackle a project like this, I push some cool tech boundaries, find out a number of fun things I can share with you all, and I end up creating yet another device I use to significantly improve my life. Whats more, routers are a sea of proprietary hardware coupled to proprietary software, and it shows. The Pi-hole project is about cutting profit margins, and the Tor network, so you wont see them on a commercial device. Your Huawei portable routers battery died? Good luck sourcing a replacement. Router randomly shutting down because of overheating? Either do something and lose your warranty, or send it away for repair for weeks with no guarantee of having it fixed, and stars help you if its made by Asus.\nFeature Plan\nI need a router with an always-on WiFi AP, LTE, Ethernet and an optional WiFi station interface. As for software, I need it to run a lightweight VPN client like Wireguard and route my traffic through it, as well as run a bunch of quality-of-life features  from reasonable static IP allocation and DNS configurability, to captive portal auto-clicking and DNSSEC. The best part about building your hardware is that you can pick your batteries and can choose cells as large as you desire, so it shouldnt be hard to make it last a day, either.\nYou also get to pick your own CPU, LTE modem, power management circuits. Thankfully, I have building blocks for most of these, and Ive discussed them before  lets talk CPUs first, and next time, go into LTE modem selection.\nYou might have seen fun boards throughout the last decade  a half-a-GHz CPU, from 64 to 512 MB of external RAM, WiFi and Ethernet interfaces done in hardware, an SPI flash for firmware, a bunch of GPIOs, OpenWRT shipped by default, and no video output interface in sight. You might have bought one for a generic Raspberry Pi grade project, misunderstanding its purpose. Its a a router CPU board, put into a maker-friendly form-factor  tt will work wonders for routing packets, but it wont work well for streaming video. I know, because I bought my first board ever with the intention of running mjpg-streamer on it, and as soon as I set it to a reasonable resolution, the CPU went to 100% consumption in a heartbeat.\nPerhaps one of the most promising router CPU modules to this day. By [Pinguinguy], CC0 1.0There are plenty of boards like this around  the VoCore, the Carambola boards, the BlackSwift boards I keep nostalgically remembering, LinkIt boards, and the Onion Omega modules. Of these, to the best of my knowledge, the Onion Omega 2 is the most up-to-date of them all, so I got one for cheap locally with a breakout  despite their name, they have nothing to do with Tor routing, though I do aim to change that. The Omega-designed breakout is underwhelming in my eyes  they used a powerbank IC to add battery backup functionality, with all the inefficiency and bugs that entails. As you might already know, you literally dont need to do that.\nStill, it ships with OpenWRT, its reasonably open, and its got everything I need. I started this project in 2018, but thankfully, I picked well  the Onion Omega repositories are active to this day, which means that, to this day, I can resume my project by just reflashing OpenWRT to a newer version; if you dont do this, you cant use the repositories meaningfully, which is a large part of the fun!\nWant to prototype a project that contains multiple components? Just tape them to a piece of board while you map it out and test things together!\nCould you pick something more powerful? Yes, absolutely  a Raspberry Pi would have a beefier CPU for anything Id want to hack  in fact, many boards today can boast a faster CPU and better peripherals. My hunch, however, is that native WiFi and Ethernet are an important thing to have  I dont want to go full USB for everything I need, lest I get throttled by the 480 Mbps restriction. Also, I do want to make sure the module I pick is well-suited for the task in aspects I might not even foresee yet, and it just feels right to use a router CPU.\nIn short, Im cool with throttling my Internet uplink in some ways, as long as this gives me a bunch of cool features in return; later on, I can do a market review and see if theres a more suitable board I could integrate, but until then, I see no boards like this. Do you have better CPU board suggestions for a portable router? Drop them in the comments down below.\nChoice Outcomes\nSo, this is what I set out to do  use an Onion Omega as my personal WiFi repeater, for now, without an LTE uplink integrated. Ive used it as my portable router, in a half-complete configuration, and heres what I found. First off, the WiFi adapter allows combined STA (station=client) and AP (access point=hotspot) mode  something that might feel like a pretty nifty feature to you, and it did to me. Initially, I thought this would allow me to do WiFi forwarding easily  and it did, but as soon as I leave the house with the router in my backpack and the STA mode goes inactive, things break.\nTest setup, creating an access point with an Ethernet uplink. With two 18650 cells, no LTE enabled, it works for about 20 hours.\nHeres a bug  if you expect an always-on AP and an occasionally active STA, your AP will be regularly glitching out, at least on the Onion Omega, and this is a fundamental problem that might translate into other hardware too. This is because, whenever the STA interface is disconnected, it needs to periodically re-scan the network to see if it needs to reconnect to an AP. Your WiFi radio needs to stop and drop what its doing, including any ongoing transmissions, and listen to the aether for a while  switching between different channels while at it. This is very noticeable when doing live audio or video streaming; if you do a local file transfer over the APs network and the transfer speed is plotted, there will be visible gaps in the transmission speed.\nFirst lesson  scrutinize cool features like the combined STA+AP modes if youre actually building a network you want to rely on, especially if you dont see them  you will notice that many devices dont come with STA+AP simultaneous connection support out of the box. Sharing an antenna for two different purposes at once feels like an error-prone situation, and if youre having a connectivity problem, you will want to look into that.\nIs the hardware support ideal? No. Is this fun so far? Yes, absolutely, and it gives some cool insights into features you might consider worth building your project around. Does this router beat the performance of a Huawei battery-powered router I used to carry in my pocket? Yep, it already has quite a few important features I always wanted to have, like static IP assignments and an Ethernet port I can use for an uplink. Now, it doesnt have LTE just yet  lets talk about that in the next article, showing you how to pick an LTE modem, and what can you do to make the process significantly easier for you.", "title": "\u30dd\u30fc\u30bf\u30d6\u30eb\u30eb\u30fc\u30bf\u30fc\u306e\u81ea\u4f5c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8", "body": "\u81ea\u4f5c\u306e\u30dd\u30fc\u30bf\u30d6\u30eb\u30eb\u30fc\u30bf\u30fc\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u7d39\u4ecb\u3057\u3001Pi-hole\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3084VPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u8a2d\u7f6e\u306a\u3069\u3001\u69d8\u3005\u306a\u6a5f\u80fd\u3092\u642d\u8f09\u3002\u7279\u306b\u5e38\u6642WiFi AP\u3084LTE\u3001Ethernet\u3092\u5fc5\u8981\u3068\u3057\u3001Onion Omega\u3092\u4f7f\u7528\u3057\u305fWiFi\u4e2d\u7d99\u6a5f\u306b\u53d6\u308a\u7d44\u3093\u3067\u3044\u308b\u3002", "titles": ["\u30dd\u30fc\u30bf\u30d6\u30eb\u30eb\u30fc\u30bf\u30fc\u306e\u81ea\u4f5c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8", "\u72ec\u81ea\u306e\u30c7\u30d0\u30a4\u30b9\u3092\u4f5c\u308b\u65b9\u6cd5", "Raspberry Pi\u3084Onion Omega 2\u3092\u6d3b\u7528\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8", "\u30ab\u30b9\u30bf\u30e0\u30eb\u30fc\u30bf\u30fc\u306e\u958b\u767a", "LTE\u30e2\u30c7\u30e0\u306e\u9078\u629e\u3068\u5c0e\u5165"]}