{"pubDate": "2024-03-07T18:00:10", "original_title": "Ethernet For Hackers: Transformers, MACs And PHYs", "link": "https://hackaday.com/2024/03/07/ethernet-for-hackers-transformers-macs-and-phys/", "source": "https://hackaday.com/blog/feed/", "thumbnail": "https://hackaday.com/wp-content/uploads/2024/02/ethernet_cable_featured.png", "original_content": "Weve talked about Ethernet basics, and weve talked about equipment you will find with Ethernet. However, thats obviously not all  you also need to know how to add Ethernet to your board and to your microcontroller. Such low-level details are harder to learn casually than the things we talked about previously, and today, we should pick up the slack.\nYou might also have some very fair question. What are the black blocks near Ethernet sockets that you generally will see on boards, and why do they look like nothing else you see on circuit boards ever? Why do some boards, like the Raspberry Pi, lack them altogether? What kind of chip do you need if you want to add Ethernet support to a microcontroller, and what might you need if your microcontroller claims to support Ethernet? Lets talk.\nTransformers Make The Data World Turn\nOne of the Ethernets many features is that its resillient, and easy to throw around. Its also galvanically isolated, which means\u00a0 you dont need a ground connection for a link either  not until you want a shield due to imposed interference, at which point, it might be that youre pulling cable inside industrial machinery. There are a few tricks to Ethernet, and one such fundamental Ethernet trick is transformers, known as magnetics in Ethernet context.\nEach pair has to be put through a transformer for the Ethernet port to work properly, as a rule. Thats the black epoxy-covered block you will inevitably see near an Ethernet port in your device. There are two places on the board as far as Ethernet goes  before the transformer, and after the transformer, and theyre treated differently. After the transformer, Ethernet is significantly more resillient to things like ground potential differences, which is how you can wire up two random computers with Ethernet and not even think about things like common mode bias or ground loops, things we must account for in audio, or digital interfaces that havent yet gone optical somehow.\n\nIf you dont see the transformer blob next to the Ethernet socket on your board, you might be thinking that your device has skimped on this part somehow, but thats not the case. If youre running Ethernet outside of your device, a transformer has to be present, which means that the RJ45 (8P8C) connector is hiding the transformer instead. A RJ45 jack with integrated magnetics is colloquially referred to as magjack, and youll have seen one if youve ever seen a Raspberry Pi. They might not always be as cheap as individual Ethernet transformers combined with magnetics-less 8P8C sockets, which is why routers, switches and laptop/desktop motherboards rarely ever use them. However, theyre simple to add, and theyre great at saving board space, which is why you will see them on single-board computers and microcontroller boards.\nIf you need some Ethernet transformers, you can buy them, but on a short notice, harvesting them is more than acceptable. Now, you have to be mindful, of course. One of the parameters of Ethernet transformers is a turns ratio, which can be different depending on the Ethernet chip in use. If youre using magnetics with a different turns ratio, it might not work, or it might make the chip in question very unhappy; consult the datasheets!\nTheres a lot to Ethernet magnetics, including tricks like capacitive coupling, where you can situationally avoid them altogether in very specific situations. We will go through the magnetic intricacies next time, but for now, they bring us to an interesting question. When a microcontroller says that it has an Ethernet port, what does it even imply? Is it enough to add a transformer, or would it need something else? It depends  lets learn about it!\nTwo Different Meanings\nThere are two parts to Ethernet support in terms of hardware. First, theres the MAC  thats a block of hardware taking care of the Ethernet protocol logic. You cant connect it directly to a transformer, but you can connect it to a PHY. The PHY works on the physical layer of Ethernet, its the piece of hardware that takes prepared Ethernet packets and translates them onto the wire. Often, MAC and PHY are just two different areas on a single chip, lets say, in desktop and laptop Ethernet chips, but just as often theyre separate.\nIf the MAC and PHY are ever separate in your device  say, the MAC is inside your ESP32 chip and the PHY is external,  the MAC will be\u00a0 will be using an interface called MII or GMII or RGMII or something along these lines. Its a parallel interface, of the kind you want to layout carefully, because it runs fast.\nIf your chip says that it supports Ethernet, that can mean two things  either it has a MAC and a PHY inside, or it only has a MAC. If the device is youre playing with is a more networking-oriented chip, say, something like a Carambola or Onion Omega board, you will have the MAC+PHY combo  just wire up a transformer of some kind, even a magjack, and you are ready to go. If youre looking at a microcontroller with Ethernet support though, say, an ESP32 or some STM, or the Pine64s Ox64, its way more likely to just have a MAC, so you will have to add a compatible PHY to your circuit before you can start wiring up the transformer.\nSo, Ethernet support for your favourite piece of silicon might mean straightforward wireup, or it might require an extra chip. Thankfully, theres no shortage of Ethernet-equipped designs to borrow things from  heres the Olimex ESP32 design for instance, open-source and giving you a circuit known to work in production. Just be careful taking PoE information from Olimex ESP32 boards  their PoE implementation, is, lets say, situationally useful, which is why theres warnings on the page about USB programming, but its a great start still!\nA Sprinkle Of Resistors\nOf course, there are plenty of schematics and reference designs to copy from, and if you do, you might wonder  what are the passives shown inside a magjack schematic, or visible on a board right next to the magnetics? Chances are, you are looking at the Bob Smith termination.\nBob Smith termination on the right of the magnetics, center tap pullups on the left.\nBob Smith termination is something you do for unterminated Ethernet pairs at 10/100Mbps, which you will likely have to work with. It shunts the unused two pairs, both connecting the two wires of each pair together so that the entire pair is treated as a single wire, but also brings the pair to a certain voltage so that any noise induced onto it over the length dont overlay onto signals on the actually used pairs. Also, this is one of the things you might burn out if you plug a passive PoE-enabled cable  the resistors will shunt the DC path; which is why PoE-compatible magnetics add extra capacitors in series with each resistor.\nOn the other side, you will see pullup resistors on the center taps of the active pairs, and capacitors to ground. Omitting either of these will cause your devices to get unhappy, so if your PHY releases magic smoke, or if your Ethernet link glitches out every now and then, you will look back and wish you added them  and it costs nothing to add footprints for them that you can populate later.\nNext time, Id like to show you open-source designs and walk you through a few of them, pointing out things that are there for a reason that you might not be aware of. There are things like isolation perimeters, shield connection, Bob Smith termination values, polarity swaps and PoE tap ways, that you likely want to talk about, and I will highlight appnotes that youd benefit from reading through, too!\nFeatured image: 10base-T by [gratuit]", "title": "\u30de\u30a4\u30af\u30ed\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306bEthernet\u3092\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5", "body": "\u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u306e\u57fa\u790e\u3068\u6a5f\u5668\u306b\u3064\u3044\u3066\u8a71\u3057\u307e\u3057\u305f\u3002\u30de\u30a4\u30af\u30ed\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306b\u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u3082\u8aac\u660e\u3002\u30c8\u30e9\u30f3\u30b9\u3092\u4f7f\u3063\u305f\u30ed\u30fc\u30ab\u30eb\u30a8\u30ea\u30a2\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a5\u7d9a\u306b\u3064\u3044\u3066\u8b70\u8ad6\u3042\u308a\u3002\u52b9\u679c\u7684\u306a\u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u30c8\u30e9\u30f3\u30b9\u8981\u7d20\u3082\u3002", "titles": ["\u30de\u30a4\u30af\u30ed\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306bEthernet\u3092\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5", "Ethernet\u30dd\u30fc\u30c8\u306e\u8fd1\u304f\u306b\u3042\u308b\u30d6\u30e9\u30c3\u30af\u30d6\u30ed\u30c3\u30af\u306e\u5f79\u5272", "Ethernet\u306e\u57fa\u672c: \u30c8\u30e9\u30f3\u30b9\u30d5\u30a9\u30fc\u30de\u30fc\u304c\u30c7\u30fc\u30bf\u3092\u5909\u3048\u308b", "\u30de\u30a4\u30af\u30ed\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3078\u306eEthernet\u30b5\u30dd\u30fc\u30c8\u306e\u8ffd\u52a0\u65b9\u6cd5", "Ethernet\u7528\u30c8\u30e9\u30f3\u30b9\u3092\u4f7f\u7528\u3059\u308b\u969b\u306e\u6ce8\u610f\u70b9"]}