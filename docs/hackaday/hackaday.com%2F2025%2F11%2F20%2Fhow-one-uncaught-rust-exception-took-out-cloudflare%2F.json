{"pubDate": "2025-11-21T03:00:46", "original_title": "How One Uncaught Rust Exception Took Out Cloudflare", "link": "https://hackaday.com/2025/11/20/how-one-uncaught-rust-exception-took-out-cloudflare/", "source": "https://hackaday.com/blog/feed/", "thumbnail": "https://hackaday.com/wp-content/uploads/2025/11/internal_server_error_cloudflare.jpg", "original_content": "On November 18 of 2025 a large part of the Internet suddenly cried out and went silent, as Cloudflares infrastructure suffered the software equivalent of a cardiac arrest. After much panicked debugging and troubleshooting, engineers were able to coax things back to life again, setting the stage for the subsequent investigation. The results of said investigation show how a mangled input file caused an exception to be thrown in the Rust-based FL2 proxy which went uncaught, throwing up an HTTP 5xx error and thus for the proxy to stop proxying customer traffic. Customers who were on the old FL proxy did not see this error.\nThe input file in question was the features file that is generated dynamically depending on the customers settings related to e.g. bot traffic. A change here resulted in said feature file to contain duplicate rows, increasing the number of typical features from about 60 to over 200, which is a problem since the proxy pre-allocates memory to contain this feature data.\n\nWhile in the FL proxy code this situation was apparently cleanly detected and handled, the new FL2 code happily chained the processing functions and ingested an error value that caused the exception. This cascaded unimpeded upwards until panic set in: thread fl2_worker_thread panicked: called Result::unwrap() on an Err value\nThe Rust code in question was the following:\n\nThe obvious problem here is that an error condition did not get handled, which is one of the most basic kind of errors. The other basic mistake seems to be that of input validation, as apparently the oversized feature file doesnt cause an issue until its attempted to stuff it into the pre-allocated memory section.\nAs we have pointed out in the past, the biggest cause of CVEs and similar is input validation and error handling. Just because youre writing in a shiny new language that never misses an opportunity to crow about how memory safe it is, doesnt mean that you can skip due diligence on input validation, checking every return value and writing exception handlers for even the most unlikely of situations.\nWe hope that Cloudflare has rolled everyone back to the clearly bulletproof FL proxy and is having a deep rethink about doing a rewrite of code that clearly wasnt broken."}